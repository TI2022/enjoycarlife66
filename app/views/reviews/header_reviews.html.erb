<p class="mt-2">
  <%= link_to 'ホーム', root_url, class: "link-gray" %> ＞
  口コミ一覧
</p>
<div class="container reviews-container">
  <div>
    <div class="d-flex flex-row bd-highlight mb-2 total_score-top mt-3">
      <div class="p-2 bd-highlight" id ="total-score-review">
        総合平均点 <span class="review-avg-score"><%= @review_total_score %> 点</span>
      </div>
      <div class="average-score">
        <div class="star-rating">
          <div class="pt-3 star-rating-front bd-highlight" style="width: <%= "#{star_width(@review_total_score)}" %>%">★★★★★</div>
          <div class="pt-3 star-rating-back bd-highlight">★★★★★</div>
        </div>
      </div>
      <div class="p-3 pl-5 bd-highlight">| メニュー・料金<%= @review_menu_score %>点</div>
      <div class="p-3 bd-highlight">| 接客・技術<%= @review_customer_score %>点</div>
      <div class="p-3 bd-highlight">| 清潔さ・雰囲気<%= @review_atmosphere_score %>点</div>
    </div>
    <p class="center">☆口コミの投稿は、施術終了後にお客様のマイページから☆</p>
    <p class="center">☆ご意見、ご要望、何でもOKです!!!☆</p>
    <% if @reviews.empty? %>
      <div>
        <p class="mt-3">まだ口コミの投稿がありません。</p>
      </div>
    <% end %>

    <div class="reviewMainWrapper">
      <table class="table reviews-table">
        <% @reviews.each do |review| %>
          <tr class="reviews-content-header">
            <td class="pr-0">総合評価</td>
            <td>
              <div class="average-score mb-3">
                <div class="star-rating ml-2">
                  <div class="star-rating-front"><%= display_star(review.total_score) %></div>
                  <div class="star-rating-back">★★★★★</div>
                </div>
                <div class="average-score-display">&nbsp;
                  ( <%= review.total_score %>/5 点 )
                </div>
              </div>
            </td>
            <td class="text-right">
              <span class="pl-2">| メニュー・料金 ★<%= review.menu_score %>点</span>
              <span class="pl-2">| 接客・技術 ★<%= review.customer_score %>点</span>
              <span class="pl-2">| 雰囲気 ★<%= review.atmosphere_score %>点</span>&nbsp;
            </td>
          </tr>

          <tr class="reviews-content-top container-fluid col-md-12">
          <div class="col-8">
            <td colspan="2"><%= review.title %></td>
          </div>
          <div class="col-4">
            <td class="text-right"><%= l(review.created_at, format: :custom1) %> 投稿</td>
          </div>
          </tr>

          <tr class="reviews-content-body">
            <td colspan="3" row="5"><%= review.content %></td>
          </tr>
          <% if current_staff %>
            <tr>
              <td colspan="3">
                  スタッフ専用 <%= link_to "お客様の口コミを削除", header_reviews_destroy_path(review), method: :delete, data:{ confirm: "お客様の口コミを削除してよろしいですか？" }, class: "btn btn-sm btn-outline-danger" %>
              </td>
            </tr>
            <tr>
            <% reservation = review.reservation %>
            <% if reservation.is_review_answered == false %>
              <td><%= link_to '口コミ返信を新規作成', new_reservation_review_answer_path(reservation, review), class: "btn btn-sm btn-outline-dark" %></td>
            <% else %>
              <% review_answer = reservation.review_answers.last %>
              <td><%= review_answer.content %></td>
              <td><%= link_to '口コミ返信を編集', edit_reservation_review_answer_path(reservation, review), class: "btn btn-sm btn-outline-dark" %></td>
              <td><%= link_to '口コミ返信を削除', reservation_review_answer_path(reservation, review), method: :delete, data:{ confirm: "口コミ返信を削除してよろしいですか？" }, class: "btn btn-sm btn-outline-danger" %></td>
            <% end %>
            </tr>

          <% end %>
        <% end %>
      </table>
      <%= paginate(@reviews) %>
    </div>
  </div>
</div>
